<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>PMSM FOC using Reduced Order Leuenberger Observer (ROLO) | Harmony 3 Motor Control Application Examples for SAM C2x family</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="PMSM FOC using Reduced Order Leuenberger Observer (ROLO)" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Motor Control applications for SAMC2x family" /> <meta property="og:description" content="Harmony 3 Motor Control applications for SAMC2x family" /> <link rel="canonical" href="../../apps/pmsm_foc_rolo_sam_c21/readme.html" /> <meta property="og:url" content="../../apps/pmsm_foc_rolo_sam_c21/readme.html" /> <meta property="og:site_name" content="Harmony 3 Motor Control Application Examples for SAM C2x family" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="PMSM FOC using Reduced Order Leuenberger Observer (ROLO)" /> <script type="application/ld+json"> {"@type":"WebPage","url":"../../apps/pmsm_foc_rolo_sam_c21/readme.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"headline":"PMSM FOC using Reduced Order Leuenberger Observer (ROLO)","description":"Harmony 3 Motor Control applications for SAMC2x family","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../index.html" class="nav-list-link">Microchip MPLAB® Harmony 3 Motor Control Application Examples for SAM C2x family</a><ul class="nav-list "><li class="nav-list-item "><a href="../../apps/acim_vhz_sam_c21/readme.html" class="nav-list-link">ACIM V/HZ Control</a></li><li class="nav-list-item "><a href="../../apps/bldc_bc_hall_sam_c21/readme.html" class="nav-list-link">BLDC Block Commutation using Hall Sensor</a></li><li class="nav-list-item "><a href="../../apps/pmsm_foc_rolo_1shunt_sam_c21/readme.html" class="nav-list-link">PMSM FOC using ROLO with single shunt current reconstruction</a></li><li class="nav-list-item "><a href="../../apps/pmsm_foc_rolo_fw_mtpa_sam_c21/readme.html" class="nav-list-link">PMSM FOC using Reduced Order Leuenberger Observer (ROLO)</a></li><li class="nav-list-item active"><a href="../../apps/pmsm_foc_rolo_sam_c21/readme.html" class="nav-list-link active">PMSM FOC using Reduced Order Leuenberger Observer (ROLO)</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../apps/docs/hardware_setup.html" class="nav-list-link">Hardware Setup</a><ul class="nav-list "><li class="nav-list-item "><a href="../../apps/docs/mchv3_samc21_pim_acim_vhz.html" class="nav-list-link">MCHV3 Development Board Setup for ACIM Sensorless Mode</a></li><li class="nav-list-item "><a href="../../apps/docs/mchv3_samc21_pim_sensorless.html" class="nav-list-link">MCHV3 Development Board Setup for PMSM Sensorless Mode</a></li><li class="nav-list-item "><a href="../../apps/docs/mclv2_samc21_pim_hall_sensor.html" class="nav-list-link">MCLV2 Development Board Setup for BLDC Hall Sensor Mode</a></li><li class="nav-list-item "><a href="../../apps/docs/mclv2_samc21_pim_sensorless.html" class="nav-list-link">MCLV2 Development Board Setup for PMSM Sensorless Mode</a></li></ul></li><li class="nav-list-item"><a href="../../release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="../../mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Harmony 3 Motor Control Application Examples for SAM C2x family" aria-label="Search Harmony 3 Motor Control Application Examples for SAM C2x family" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../index.html">Microchip MPLAB® Harmony 3 Motor Control Application Examples for SAM C2x family</a></li> <li class="breadcrumb-nav-list-item"><span>PMSM FOC using Reduced Order Leuenberger Observer (ROLO)</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="pmsm-foc-using-reduced-order-luenberger-observer"> <a href="#pmsm-foc-using-reduced-order-luenberger-observer" aria-labelledby="pmsm-foc-using-reduced-order-luenberger-observer" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PMSM FOC using Reduced Order Luenberger Observer </h1> <p>This application implements the sensorless field oriented control (FOC) of a permanent magnet synchronous motor (PMSM). It estimates rotor position from measured phase currents and a reduced order luenberger observer (ROLO). This algorithm is implemented on a SAMC21J18A MCU.</p> <h2 id="description"> <a href="#description" aria-labelledby="description" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h2> <p>Permanent Magnet Synchronous Motor (PMSM) is controlled using Field Oriented Control (FOC). Rotor position and speed is determined using Reduced Order Luenberger Observer. Motor start/stop operation is controlled by the switch and motor speed can be changed by the on-board potentiometer. Waveforms and variables can be monitored runtime using X2CScope.</p> <p>Key features enabled in this project are:</p> <ul> <li>Dual shunt current measurement</li> <li>Speed control loop</li> </ul> <h2 id="mhc-project-configurations"> <a href="#mhc-project-configurations" aria-labelledby="mhc-project-configurations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MHC Project Configurations </h2> <p><img src="../../apps/pmsm_foc_rolo_sam_c21/images/pmsm_foc_rolo_project_graph.jpg" alt="MHC Project Graph" /></p> <ul> <li> <p><strong>PMSM_FOC</strong>:</p> <ul> <li>This component configures FOC algorithm parameters, motor parameters and motor control board parameters. It connects to underlying peripheral libraries ADC and TCC. This component auto configures ADC channels and PWM channels as per PMSM_FOC component configurations.</li> </ul> </li> <li> <p><strong>ADC0-ADC1 Peripheral</strong>:</p> <ul> <li>ADC0 and ADC1 are setup to operate in Master - Slave mode with ADC0 acting as a Master.</li> <li>Both ADCs convert single ended inputs. Phase U current is sampled and converted by ADC0 and Phase V current is sampled and converted by ADC1.</li> <li>Both ADCs are hardware triggered simultaneously by an event generated from TCC0 at the end of each PWM cycle.</li> <li>Conversion Ready interrupt is generated by ADC0. Since both ADCs are triggered simultaneously and have same resolution and sampling time, both ADCs complete conversion at the same time.</li> </ul> </li> <li> <p><strong>TCC0 Peripheral</strong>:</p> <p>Configured to generate three pairs of complimentary PWM signals at a frequency of 10 kHz in “Dual Slope PWM with interrupt/event when counter = ZERO” a.k.a. “Center Aligned Mode”.</p> <ul> <li>Event output is enabled which is generated when the counter reaches ZERO.</li> <li>Dead-time is enabled and set to <ul> <li>mchv3_sam_c21_pim.X. - 2uS</li> <li>mclv2_sam_c21_pim.X. - 1uS</li> </ul> </li> <li>Non-recoverable Fault is enabled on EV0. When an event is detected on EV0, all PWM channels are held low.</li> </ul> </li> <li><strong>EIC</strong>: <ul> <li>External Interrupt Controller detects a hardware over-current fault input and generates a non-recoverable fault event for TCC0, thereby shutting down the PWM in the event of an over-current fault.</li> </ul> </li> <li><strong>EVSYS</strong>: <ul> <li>Event System acts as an intermediary between event generator and event users.</li> <li>Event generated by the TCC0 when the counter reaches ZERO, is used by the ADC0 as a hardware trigger source via the Event System.</li> <li>Event generated by the EIC upon over-current fault, is used by the TCC0 as a non-recoverable fault event via the Event System.</li> </ul> </li> <li><strong>DIVAS</strong>: <ul> <li>This demo uses “Divide and Square Root Accelerator” to perform 32-bit signed and unsigned division and 32-bit unsigned square root operations.</li> <li>DIVAS is set to overload “Divide - / “ operator i.e. c = a / b; would use DIVAS accelerator for division without using a special API. However, square root operation would still require a special API. Refer to the DIVAS help for more details.</li> </ul> </li> <li><strong>SERCOM3 Peripheral</strong>: <ul> <li>SERCOM3 is configured in USART mode and is set to operate at 115200 bps.</li> <li>This USART channel is used by the X2CScope plugin to plot or watch global variables in run-time. Refer to X2C Scope Plugin section for more details on how to install and use the X2CScope.</li> </ul> </li> </ul> <h2 id="control-algorithm"> <a href="#control-algorithm" aria-labelledby="control-algorithm" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Control Algorithm </h2> <p>This section briefly explains the FOC control algorithm, software design and implementation. Refer to <a href="http://ww1.microchip.com/downloads/en/Appnotes/00002590B.pdf">Application note AN2590</a> for the ROLO based estimator based sensor-less FOC technique in detail.</p> <p>Field Oriented Control is the technique used to achieve the decoupled control of torque and flux. This is done by transforming the stator current quantities (phase currents) from stationary reference frame to torque and flux producing currents components in rotating reference frame using mathematical transformations. The Field Oriented Control is done as follows:</p> <ol> <li>Measure the motor phase currents.</li> <li>Transform them into the two phase system (a, b) using the Clarke transformation.</li> <li>Measure the rotor position angle.</li> <li>Transform stator currents into the d,q-coordinate system using the Park transformation.</li> <li>The stator current torque (iq) and flux (id) producing components are controlled separately by the controllers.</li> <li>The output stator voltage space vector is transformed back from the d,q-coordinate system into the two phase system fixed with the stator by the Inverse Park transformation.</li> <li>Using the space vector modulation, the three-phase output voltage is generated.</li> </ol> <p>The following block diagram shows the software realization of the FOC algorithm.</p> <p><img src="../../apps/pmsm_foc_rolo_sam_c21/images/sensorless_foc_block_diagram.jpg" alt="Block Diagram" /></p> <h2 id="software-design"> <a href="#software-design" aria-labelledby="software-design" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Software Design </h2> <p>Please refer to <a href="https://microchip-mplab-harmony.github.io/motor_control/">PMSM_FOC Library</a> for state machine, flow charts and detailed software design.</p> <h2 id="development-kits"> <a href="#development-kits" aria-labelledby="development-kits" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Kits </h2> <h3 id="mclv2-with-samc21-family-motor-control-pim"> <a href="#mclv2-with-samc21-family-motor-control-pim" aria-labelledby="mclv2-with-samc21-family-motor-control-pim" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCLV2 with SAMC21 Family Motor Control PIM </h3> <h4 id="downloading-and-building-the-application"> <a href="#downloading-and-building-the-application" aria-labelledby="downloading-and-building-the-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Downloading and building the application </h4> <p>To clone or download this application from Github, go to the <a href="https://github.com/Microchip-MPLAB-Harmony/mc_apps_sam_c2x">main page of this repository</a> and then click <strong>Clone</strong> button to clone this repository or download as zip file. This content can also be downloaded using content manager by following these <a href="https://github.com/Microchip-MPLAB-Harmony/contentmanager/wiki">instructions</a>.</p> <p>Path of the application within the repository is <strong>apps/pmsm_foc_rolo_sam_c21</strong> .</p> <p>To build the application, refer to the following table and open the project using its IDE.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Project Name</th> <th>Description</th> <th>Demo User Guide</th> </tr> </thead> <tbody> <tr> <td>mclv2_sam_c21_pim.X</td> <td>MPLABX project for MCLV2 board with SAMC21 PIM</td> <td><a href="../../apps/docs/mclv2_samc21_pim_sensorless.html">MCLV2 with SAMC21 PIM</a></td> </tr> <tr> <td> </td> <td> </td> <td> </td> </tr> </tbody> </table></div> <h3 id="mchv3-with-samc21-family-motor-control-pim"> <a href="#mchv3-with-samc21-family-motor-control-pim" aria-labelledby="mchv3-with-samc21-family-motor-control-pim" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MCHV3 with SAMC21 Family Motor Control PIM </h3> <h4 id="downloading-and-building-the-application-1"> <a href="#downloading-and-building-the-application-1" aria-labelledby="downloading-and-building-the-application-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Downloading and building the application </h4> <p>To clone or download this application from Github, go to the <a href="https://github.com/Microchip-MPLAB-Harmony/mc_apps_sam_c2x">main page of this repository</a> and then click <strong>Clone</strong> button to clone this repository or download as zip file. This content can also be downloaded using content manager by following these <a href="https://github.com/Microchip-MPLAB-Harmony/contentmanager/wiki">instructions</a>.</p> <p>Path of the application within the repository is <strong>apps/pmsm_foc_rolo_sam_c21</strong> .</p> <p>To build the application, refer to the following table and open the project using its IDE.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Project Name</th> <th>Description</th> <th>Demo User Guide</th> </tr> </thead> <tbody> <tr> <td>mchv3_sam_c21_pim.X</td> <td>MPLABX project for MCHV3 board with SAMC21 PIM</td> <td><a href="../../apps/docs/mchv3_samc21_pim_sensorless.html">MCHV3 with SAMC21 PIM</a></td> </tr> <tr> <td> </td> <td> </td> <td> </td> </tr> </tbody> </table></div> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
